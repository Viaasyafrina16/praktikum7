<!DOCTYPE html>
<html>
<head>
    <title>API Key System</title>
    <meta charset="UTF-8">
</head>
<body>
    <h1>Generate API Key</h1>

    <button onclick="generateKey()">Generate API Key</button>

    <div id="generated"></div>

    <hr>

    <h2>Buat User & Assign API Key</h2>

    <input type="text" id="firstname" placeholder="Firstname"><br><br>
    <input type="text" id="lastname" placeholder="Lastname"><br><br>
    <input type="email" id="email" placeholder="Email"><br><br>

    <input type="text" id="api_key" placeholder="Masukkan API Key (opsional)"><br><br>

    <button onclick="saveUser()">Save User</button>

    <hr>

    <a href="./admin/login.html">Login Admin</a> |
    <a href="./admin/register.html">Register Admin</a>

    <script>
        async function generateKey() {
            const token = localStorage.getItem("token");

            const res = await fetch("/api/apikey/generate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                }
            });

            const data = await res.json();
            document.getElementById("generated").innerText =
                "Generated Key: " + (data.apikey?.api_key || "Gagal");
        }

        async function saveUser() {
            const body = {
                firstname: document.getElementById("firstname").value,
                lastname: document.getElementById("lastname").value,
                email: document.getElementById("email").value,
                api_key: document.getElementById("api_key").value
            };

            const res = await fetch("/api/user/create", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            const data = await res.json();
            alert(data.message);
        }
    </script>
</body>
</html>
