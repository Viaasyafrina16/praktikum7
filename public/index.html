<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API Key System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 30px;
        }
        h1, h2 {
            margin-bottom: 10px;
        }
        input {
            padding: 8px;
            width: 250px;
        }
        button {
            padding: 8px 15px;
            margin-top: 5px;
            cursor: pointer;
        }
        .section {
            margin-bottom: 40px;
        }
        .nav {
            margin-top: 20px;
        }
        a {
            margin-right: 10px;
        }
        #generated {
            margin-top: 10px;
            font-weight: bold;
            color: green;
        }
    </style>
</head>
<body>

    <h1>API Key System</h1>

    <!-- ======================= -->
    <!-- Generate API Key -->
    <!-- ======================= -->
    <div class="section">
        <h2>Generate API Key</h2>
        <button onclick="generateKey()">Generate API Key</button>
        <div id="generated"></div>
    </div>

    <hr>

    <!-- ======================= -->
    <!-- Create User + Assign API -->
    <!-- ======================= -->
    <div class="section">
        <h2>Buat User & Assign API Key</h2>

        <input type="text" id="firstname" placeholder="Firstname"><br><br>
        <input type="text" id="lastname" placeholder="Lastname"><br><br>
        <input type="email" id="email" placeholder="Email"><br><br>
        <input type="text" id="api_key" placeholder="Masukkan API Key (opsional)"><br><br>

        <button onclick="saveUser()">Save User</button>
    </div>

    <hr>

    <!-- ======================= -->
    <!-- Navigasi -->
    <!-- ======================= -->
    <div class="nav">
        <h3>Admin Navigation</h3>
        <a href="./admin/login.html">Login Admin</a>
        <a href="./admin/register.html">Register Admin</a>
        <a href="./admin/dashboard.html">Admin Dashboard</a>
    </div>

    <script>
        async function generateKey() {
            const token = localStorage.getItem("token");

            const res = await fetch("/api/apikey/generate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                }
            });

            const data = await res.json();
            document.getElementById("generated").innerText =
                "Generated Key: " + (data.apikey?.api_key || "Gagal generate");
        }

        async function saveUser() {
            const body = {
                firstname: document.getElementById("firstname").value,
                lastname: document.getElementById("lastname").value,
                email: document.getElementById("email").value,
                api_key: document.getElementById("api_key").value
            };

            const res = await fetch("/api/user/create", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            const data = await res.json();
            alert(data.message || "User berhasil ditambahkan");
        }
    </script>

</body>
</html>
